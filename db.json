{"meta":{"version":1,"warehouse":"5.0.1"},"models":{"Asset":[{"_id":"node_modules/hexo-theme-landscape/source/css/style.styl","path":"css/style.styl","modified":1,"renderable":1},{"_id":"node_modules/hexo-theme-landscape/source/js/jquery-3.6.4.min.js","path":"js/jquery-3.6.4.min.js","modified":1,"renderable":1},{"_id":"node_modules/hexo-theme-landscape/source/js/script.js","path":"js/script.js","modified":1,"renderable":1},{"_id":"node_modules/hexo-theme-landscape/source/fancybox/jquery.fancybox.min.js","path":"fancybox/jquery.fancybox.min.js","modified":1,"renderable":1},{"_id":"node_modules/hexo-theme-landscape/source/fancybox/jquery.fancybox.min.css","path":"fancybox/jquery.fancybox.min.css","modified":1,"renderable":1},{"_id":"node_modules/hexo-theme-landscape/source/css/images/banner.jpg","path":"css/images/banner.jpg","modified":1,"renderable":1}],"Cache":[{"_id":"source/_posts/liwary.md","hash":"47b04dfb716df4bcf67501caf624ae48dc43ed91","modified":1709216243739},{"_id":"node_modules/hexo-theme-landscape/LICENSE","hash":"c480fce396b23997ee23cc535518ffaaf7f458f8","modified":1709206192485},{"_id":"node_modules/hexo-theme-landscape/package.json","hash":"4bf95d52f77edf811f23f6d264a7493311a8d078","modified":1709206192718},{"_id":"node_modules/hexo-theme-landscape/README.md","hash":"1a9b279e6dd29fd19245f913f0c4a316ffaa62db","modified":1709206192721},{"_id":"node_modules/hexo-theme-landscape/_config.yml","hash":"b608c1f1322760dce9805285a602a95832730a2e","modified":1709206192772},{"_id":"node_modules/hexo-theme-landscape/languages/de-DE.yml","hash":"d29d1c4256b7ed9df42f511c2ff0a23ad5fd6c1f","modified":1709206192774},{"_id":"node_modules/hexo-theme-landscape/languages/en-GB.yml","hash":"ea5e6aee4cb14510793ac4593a3bddffe23e530c","modified":1709206192779},{"_id":"node_modules/hexo-theme-landscape/languages/de.yml","hash":"3ebf0775abbee928c8d7bda943c191d166ded0d3","modified":1709206192776},{"_id":"node_modules/hexo-theme-landscape/languages/default.yml","hash":"ea5e6aee4cb14510793ac4593a3bddffe23e530c","modified":1709206192778},{"_id":"node_modules/hexo-theme-landscape/languages/en.yml","hash":"3083f319b352d21d80fc5e20113ddf27889c9d11","modified":1709206192782},{"_id":"node_modules/hexo-theme-landscape/languages/es-ES.yml","hash":"7008a8fc91f18d2a735864817b8ebda30c7a2c66","modified":1709206192784},{"_id":"node_modules/hexo-theme-landscape/languages/en-US.yml","hash":"ea5e6aee4cb14510793ac4593a3bddffe23e530c","modified":1709206192781},{"_id":"node_modules/hexo-theme-landscape/languages/fr-FR.yml","hash":"8d09dbdab00a30a2870b56f7c0a7ca7deafa7b88","modified":1709206192787},{"_id":"node_modules/hexo-theme-landscape/languages/es.yml","hash":"76edb1171b86532ef12cfd15f5f2c1ac3949f061","modified":1709206192786},{"_id":"node_modules/hexo-theme-landscape/languages/fr.yml","hash":"415e1c580ced8e4ce20b3b0aeedc3610341c76fb","modified":1709206192789},{"_id":"node_modules/hexo-theme-landscape/languages/hu-HU.yml","hash":"712d18664898fa21ba38d4973e90ef41a324ea25","modified":1709206192791},{"_id":"node_modules/hexo-theme-landscape/languages/hu.yml","hash":"284d557130bf54a74e7dcef9d42096130e4d9550","modified":1709206192793},{"_id":"node_modules/hexo-theme-landscape/languages/it-IT.yml","hash":"2cb6dc2fab9bd2dbe1c8bb869a9e8bf85a564fdd","modified":1709206192794},{"_id":"node_modules/hexo-theme-landscape/languages/it.yml","hash":"89b7d91306b2c1a0f3ac023b657bf974f798a1e8","modified":1709206192796},{"_id":"node_modules/hexo-theme-landscape/languages/ja.yml","hash":"a73e1b9c80fd6e930e2628b393bfe3fb716a21a9","modified":1709206192800},{"_id":"node_modules/hexo-theme-landscape/languages/ja-JP.yml","hash":"08481267e0c112e1f6855620f2837ec4c4a98bbd","modified":1709206192798},{"_id":"node_modules/hexo-theme-landscape/languages/ko-KR.yml","hash":"19209ad8f9d4057e8df808937f950eb265e1db69","modified":1709206192801},{"_id":"node_modules/hexo-theme-landscape/languages/mn-MN.yml","hash":"b9e5f3e7c0c2f779cf2cfded6db847b5941637ca","modified":1709206192805},{"_id":"node_modules/hexo-theme-landscape/languages/ko.yml","hash":"881d6a0a101706e0452af81c580218e0bfddd9cf","modified":1709206192803},{"_id":"node_modules/hexo-theme-landscape/languages/mn.yml","hash":"2e7523951072a9403ead3840ad823edd1084c116","modified":1709206192806},{"_id":"node_modules/hexo-theme-landscape/languages/nl-NL.yml","hash":"5ebbc30021f05d99938f96dfff280392df7f91f0","modified":1709206192809},{"_id":"node_modules/hexo-theme-landscape/languages/nl.yml","hash":"12ed59faba1fc4e8cdd1d42ab55ef518dde8039c","modified":1709206192810},{"_id":"node_modules/hexo-theme-landscape/languages/no.yml","hash":"965a171e70347215ec726952e63f5b47930931ef","modified":1709206192811},{"_id":"node_modules/hexo-theme-landscape/languages/pt-PT.yml","hash":"0f852b6b228e6ea59aa3540574bb89b233f2a098","modified":1709206192813},{"_id":"node_modules/hexo-theme-landscape/languages/ru-RU.yml","hash":"360d11a28bb768afb1dd15f63fa7fd3a8cc547ee","modified":1709206192817},{"_id":"node_modules/hexo-theme-landscape/languages/ru.yml","hash":"4fda301bbd8b39f2c714e2c934eccc4b27c0a2b0","modified":1709206192818},{"_id":"node_modules/hexo-theme-landscape/languages/th-TH.yml","hash":"ebfdba9bc4842c829473c1e6e4544344f182724d","modified":1709206192820},{"_id":"node_modules/hexo-theme-landscape/languages/pt.yml","hash":"57d07b75d434fbfc33b0ddb543021cb5f53318a8","modified":1709206192815},{"_id":"node_modules/hexo-theme-landscape/languages/th.yml","hash":"84a55b00aa01f03982be294e43c33a20e6d32862","modified":1709206192822},{"_id":"node_modules/hexo-theme-landscape/languages/tr.yml","hash":"a1cdbfa17682d7a971de8ab8588bf57c74224b5b","modified":1709206192823},{"_id":"node_modules/hexo-theme-landscape/languages/zh-CN.yml","hash":"1efd95774f401c80193eac6ee3f1794bfe93dc5a","modified":1709206192825},{"_id":"node_modules/hexo-theme-landscape/languages/zh-TW.yml","hash":"53ce3000c5f767759c7d2c4efcaa9049788599c3","modified":1709206192826},{"_id":"node_modules/hexo-theme-landscape/scripts/fancybox.js","hash":"c857d7a5e4a5d71c743a009c5932bf84229db428","modified":1709206192692},{"_id":"node_modules/hexo-theme-landscape/layout/archive.ejs","hash":"2703b07cc8ac64ae46d1d263f4653013c7e1666b","modified":1709206192528},{"_id":"node_modules/hexo-theme-landscape/layout/category.ejs","hash":"765426a9c8236828dc34759e604cc2c52292835a","modified":1709206192550},{"_id":"node_modules/hexo-theme-landscape/layout/layout.ejs","hash":"0d1765036e4874500e68256fedb7470e96eeb6ee","modified":1709206192594},{"_id":"node_modules/hexo-theme-landscape/layout/post.ejs","hash":"7d80e4e36b14d30a7cd2ac1f61376d9ebf264e8b","modified":1709206192614},{"_id":"node_modules/hexo-theme-landscape/layout/index.ejs","hash":"aa1b4456907bdb43e629be3931547e2d29ac58c8","modified":1709206192588},{"_id":"node_modules/hexo-theme-landscape/layout/tag.ejs","hash":"eaa7b4ccb2ca7befb90142e4e68995fb1ea68b2e","modified":1709206192640},{"_id":"node_modules/hexo-theme-landscape/layout/page.ejs","hash":"7d80e4e36b14d30a7cd2ac1f61376d9ebf264e8b","modified":1709206192609},{"_id":"node_modules/hexo-theme-landscape/layout/_partial/after-footer.ejs","hash":"377d257d5d16e0158a4405c72401517b074fd7ff","modified":1709206192502},{"_id":"node_modules/hexo-theme-landscape/layout/_partial/article.ejs","hash":"56597e951203dd662a6d2c817c7c4f1c920d4a25","modified":1709206192533},{"_id":"node_modules/hexo-theme-landscape/layout/_partial/archive-post.ejs","hash":"c7a71425a946d05414c069ec91811b5c09a92c47","modified":1709206192507},{"_id":"node_modules/hexo-theme-landscape/layout/_partial/archive.ejs","hash":"7cb70a7a54f8c7ae49b10d1f37c0a9b74eab8826","modified":1709206192511},{"_id":"node_modules/hexo-theme-landscape/layout/_partial/footer.ejs","hash":"3656eb692254346671abc03cb3ba1459829e0dce","modified":1709206192560},{"_id":"node_modules/hexo-theme-landscape/layout/_partial/gauges-analytics.ejs","hash":"21a1e2a3907d1a3dad1cd0ab855fe6735f233c74","modified":1709206192568},{"_id":"node_modules/hexo-theme-landscape/layout/_partial/google-analytics.ejs","hash":"2ea7442ea1e1a8ab4e41e26c563f58413b59a3d0","modified":1709206192573},{"_id":"node_modules/hexo-theme-landscape/layout/_partial/header.ejs","hash":"6a5033d189554c9a6d42e2ef7952ae5c9742648e","modified":1709206192584},{"_id":"node_modules/hexo-theme-landscape/layout/_partial/mobile-nav.ejs","hash":"e952a532dfc583930a666b9d4479c32d4a84b44e","modified":1709206192599},{"_id":"node_modules/hexo-theme-landscape/layout/_partial/sidebar.ejs","hash":"930da35cc2d447a92e5ee8f835735e6fd2232469","modified":1709206192626},{"_id":"node_modules/hexo-theme-landscape/layout/_partial/head.ejs","hash":"f05bced793b0314d4f2ef0c993b3a51d0b7d203a","modified":1709206192578},{"_id":"node_modules/hexo-theme-landscape/layout/_widget/archive.ejs","hash":"beb4a86fcc82a9bdda9289b59db5a1988918bec3","modified":1709206192521},{"_id":"node_modules/hexo-theme-landscape/layout/_widget/category.ejs","hash":"dd1e5af3c6af3f5d6c85dfd5ca1766faed6a0b05","modified":1709206192545},{"_id":"node_modules/hexo-theme-landscape/layout/_widget/recent_posts.ejs","hash":"60c4b012dcc656438ff59997e60367e5a21ab746","modified":1709206192620},{"_id":"node_modules/hexo-theme-landscape/layout/_widget/tag.ejs","hash":"2de380865df9ab5f577f7d3bcadf44261eb5faae","modified":1709206192635},{"_id":"node_modules/hexo-theme-landscape/layout/_widget/tagcloud.ejs","hash":"b4a2079101643f63993dcdb32925c9b071763b46","modified":1709206192644},{"_id":"node_modules/hexo-theme-landscape/source/css/_variables.styl","hash":"ca28281423ae57d76b6c1eb91cd845fd4e518bd6","modified":1709206192732},{"_id":"node_modules/hexo-theme-landscape/source/css/_extend.styl","hash":"222fbe6d222531d61c1ef0f868c90f747b1c2ced","modified":1709206192728},{"_id":"node_modules/hexo-theme-landscape/source/css/style.styl","hash":"e55a1d92954ed20f6887f92dc727bb995a010a43","modified":1709206192770},{"_id":"node_modules/hexo-theme-landscape/source/js/script.js","hash":"49773efcb2221bbdf2d86f3f5c5ff2d841b528cc","modified":1709206192714},{"_id":"node_modules/hexo-theme-landscape/source/fancybox/jquery.fancybox.min.css","hash":"1be9b79be02a1cfc5d96c4a5e0feb8f472babd95","modified":1709206192493},{"_id":"node_modules/hexo-theme-landscape/layout/_partial/post/date.ejs","hash":"f1458584b679545830b75bef2526e2f3eb931045","modified":1709206192555},{"_id":"node_modules/hexo-theme-landscape/layout/_partial/post/gallery.ejs","hash":"3d9d81a3c693ff2378ef06ddb6810254e509de5b","modified":1709206192564},{"_id":"node_modules/hexo-theme-landscape/layout/_partial/post/nav.ejs","hash":"16a904de7bceccbb36b4267565f2215704db2880","modified":1709206192604},{"_id":"node_modules/hexo-theme-landscape/layout/_partial/post/category.ejs","hash":"c6bcd0e04271ffca81da25bcff5adf3d46f02fc0","modified":1709206192540},{"_id":"node_modules/hexo-theme-landscape/layout/_partial/post/tag.ejs","hash":"2fcb0bf9c8847a644167a27824c9bb19ac74dd14","modified":1709206192631},{"_id":"node_modules/hexo-theme-landscape/layout/_partial/post/title.ejs","hash":"4d7e62574ddf46de9b41605fe3140d77b5ddb26d","modified":1709206192650},{"_id":"node_modules/hexo-theme-landscape/source/css/_partial/archive.styl","hash":"db15f5677dc68f1730e82190bab69c24611ca292","modified":1709206192737},{"_id":"node_modules/hexo-theme-landscape/source/css/_partial/comment.styl","hash":"79d280d8d203abb3bd933ca9b8e38c78ec684987","modified":1709206192747},{"_id":"node_modules/hexo-theme-landscape/source/css/_partial/header.styl","hash":"268d2989acb06e2ddd06cc36a6918c6cd865476b","modified":1709206192756},{"_id":"node_modules/hexo-theme-landscape/source/css/_partial/footer.styl","hash":"e35a060b8512031048919709a8e7b1ec0e40bc1b","modified":1709206192750},{"_id":"node_modules/hexo-theme-landscape/source/css/_partial/highlight.styl","hash":"9cc3b2927d814f2f6e8e188f9d3657b94f4c6ef3","modified":1709206192758},{"_id":"node_modules/hexo-theme-landscape/source/css/_partial/mobile.styl","hash":"a399cf9e1e1cec3e4269066e2948d7ae5854d745","modified":1709206192763},{"_id":"node_modules/hexo-theme-landscape/source/css/_partial/sidebar-aside.styl","hash":"890349df5145abf46ce7712010c89237900b3713","modified":1709206192764},{"_id":"node_modules/hexo-theme-landscape/source/css/_partial/sidebar-bottom.styl","hash":"8fd4f30d319542babfd31f087ddbac550f000a8a","modified":1709206192766},{"_id":"node_modules/hexo-theme-landscape/source/css/_partial/sidebar.styl","hash":"404ec059dc674a48b9ab89cd83f258dec4dcb24d","modified":1709206192768},{"_id":"node_modules/hexo-theme-landscape/source/css/_util/grid.styl","hash":"0bf55ee5d09f193e249083602ac5fcdb1e571aed","modified":1709206192754},{"_id":"node_modules/hexo-theme-landscape/source/css/_util/mixin.styl","hash":"44f32767d9fd3c1c08a60d91f181ee53c8f0dbb3","modified":1709206192761},{"_id":"node_modules/hexo-theme-landscape/source/css/_partial/article.styl","hash":"2d1f6f79ebf9cb55ebdb3865a2474437eb2b37c6","modified":1709206192744},{"_id":"node_modules/hexo-theme-landscape/source/js/jquery-3.6.4.min.js","hash":"eda46747c71d38a880bee44f9a439c3858bb8f99","modified":1709206192702},{"_id":"node_modules/hexo-theme-landscape/source/fancybox/jquery.fancybox.min.js","hash":"6181412e73966696d08e1e5b1243a572d0f22ba6","modified":1709206192710},{"_id":"node_modules/hexo-theme-landscape/source/css/images/banner.jpg","hash":"f44aa591089fcb3ec79770a1e102fd3289a7c6a6","modified":1709206192686},{"_id":"public/index.html","hash":"bb5cd1a0aab070697948552ff50d008ac6d6233d","modified":1709220247981},{"_id":"public/archives/index.html","hash":"f716e196a8f47b57a298b6ff959d0292a6fb100c","modified":1709220247981},{"_id":"public/2024/02/29/liwary/index.html","hash":"055c56a119f624d0497342043ae3d59dbb323394","modified":1709220247981},{"_id":"public/archives/2024/index.html","hash":"b86411a88defcf3040cef19e20b19621bfd2e5c0","modified":1709220247981},{"_id":"public/archives/2024/02/index.html","hash":"6ce824f753018b1716853a8a2a736d44e0992b9a","modified":1709220247981},{"_id":"public/css/style.css","hash":"ddb3792605d744ab3d9f0a649c82b62e9b16daa6","modified":1709220247981},{"_id":"public/js/jquery-3.6.4.min.js","hash":"eda46747c71d38a880bee44f9a439c3858bb8f99","modified":1709220247981},{"_id":"public/fancybox/jquery.fancybox.min.css","hash":"1be9b79be02a1cfc5d96c4a5e0feb8f472babd95","modified":1709220247981},{"_id":"public/js/script.js","hash":"49773efcb2221bbdf2d86f3f5c5ff2d841b528cc","modified":1709220247981},{"_id":"public/fancybox/jquery.fancybox.min.js","hash":"6181412e73966696d08e1e5b1243a572d0f22ba6","modified":1709220247981},{"_id":"public/css/images/banner.jpg","hash":"f44aa591089fcb3ec79770a1e102fd3289a7c6a6","modified":1709220247981}],"Category":[],"Data":[],"Page":[],"Post":[{"title":"liwary","date":"2024-02-29T13:45:18.000Z","_content":"\nLibwary Writeup\n                \n*Disclaimer: I neither did this completely on my own nor did this during the competition. Although I solved 90% on my own, I did get a pretty big hint*\n\n\nRECON\n========================================================\nThe Website\n-\n\nWe are presented with a dropdown menu with 5 books. One of them is called \"The flag\", which obviously immediately gives us the flag and this writeup doesn't actually exist.\n\nMoving on, we can select which book to read, and it its contents are shown on the page.\n\nThere aren't any other ways to give user inputs, and we can't modify any of the options, so we look elsewhere. I noticed that there is a PHPSESSID, of course in base64.\nDecrypting this, we are provided with a serialised PHP object.\n\n`O:4:\"User\":1:{s:4:\"name\";s:12:\"User86968804\";}`\n\n\n*Here comes me being dumb. As this was my first ever CTF competition, I had very little experience and had no clue what PHP deserialisation was. So, I gave up here during the competition, after which someone told me that the solution was PHP deserialisation, and a few Google searches later, I solved it (yay).*\n\nDeserialising the object, we get:\n\n\n`__PHP_Incomplete_Class Object`\n`(`\n`    [__PHP_Incomplete_Class_Name] => User`\n`    [name] => User86968804`\n`)`\n\nEssentially, the token is a serialized PHP object of class `User` and a value for name.\n\nVery interesting. We may be able to exploit this in the future as the code displays \"Welcome to the Libwary, {name}\"\n\n\nFiles and source\n-\n\nWe are given a file, Libwary.zip. In it we have 2 PHP files, index.php and util.php as well as a directory containing the books, fakeflag.txt and flag.txt, of course with the redacted flag.\n\nOpening util.php, we can see the following:\n\n\n\n![Alt text](https://www.pexels.com/photo/a-close-up-of-a-blue-glacier-20147180/)\n\nWe notice that there are two classes,  `book`  and `user`. The User class does... well not really anything. However, the book class is interesting. We can see that it uses the `$name` variable to find the corresponding book and then returns the content whenever an instance of the class is treated as a string.\n\nAlso note that if the name is not `fakeflag` but the name contains \"flag\", the word \"flag\" gets deleted.\n\n\nEXPLOIT\n=======\nNow for the fun part, exploitation.\n\nThe Big Idea\n--\nThe main vulnerability lies in these two lines:\n\n`$user = unserialize(base64_decode($_COOKIE['PHPSESSID']));`\nand, of course\n`echo $user;`\n\nIf we can get `echo $user` to echo the contents of a Book object, we could just use that to get the contents of flag.txt. \n\nVery conveniently, the `__tostring()` function does exactly what we need. If we just changed the PHPSESSID cookie to a serialised object of class `Book`, like, say, I don't know, a `Book` object with the name flag.txt, it would just echo out the contents.\n\nExecution\n--\n\nFirstly, we create a serialised object that looks like this:\n\n`O:4:\"Book\":1:{s:4:\"name\";s:8:\"flag.txt\";}`\n\nThis creates an instance of `Book` that has the name \"flag.txt\".\n\nNext, we encode it in Base64 to get this:\n\n`Tzo0OiJCb29rIjoxOntzOjQ6Im5hbWUiO3M6ODoiZmxhZy50eHQiO30`\n\nPassing this into our PHPSESSID and...\n\nimage to be added\n\nWhoops. Forgot about the final defence code.\n\n`//final defence`\n \n` if ($this->name != \"fakeflag.txt\") $this->name = str_ireplace(\"flag\", \"\", $this->name);`\n\nHowever, this is an easy fix. We just change up our serialised object to this:\n `O:4:\"Book\":1:{s:4:\"name\";s:12:\"flaflagg.txt\";}` \n\nWhen the code tries to replace the \"flag\" inf \"flaflagg\", it just gives us back \"flag.txt\"\n\nRe-encoding and re-serialising, we get:\n\n`Tzo0OiJCb29rIjoxOntzOjQ6Im5hbWUiO3M6MTI6ImZsZmxhZ2FnLnR4dCI7fQ`\n\nNow we pass this into our PHPSESSID and..\n\nimage\n\nBam. Flag.","source":"_posts/liwary.md","raw":"---\ntitle: liwary\ndate: 2024-02-29 21:45:18\ntags:\n---\n\nLibwary Writeup\n                \n*Disclaimer: I neither did this completely on my own nor did this during the competition. Although I solved 90% on my own, I did get a pretty big hint*\n\n\nRECON\n========================================================\nThe Website\n-\n\nWe are presented with a dropdown menu with 5 books. One of them is called \"The flag\", which obviously immediately gives us the flag and this writeup doesn't actually exist.\n\nMoving on, we can select which book to read, and it its contents are shown on the page.\n\nThere aren't any other ways to give user inputs, and we can't modify any of the options, so we look elsewhere. I noticed that there is a PHPSESSID, of course in base64.\nDecrypting this, we are provided with a serialised PHP object.\n\n`O:4:\"User\":1:{s:4:\"name\";s:12:\"User86968804\";}`\n\n\n*Here comes me being dumb. As this was my first ever CTF competition, I had very little experience and had no clue what PHP deserialisation was. So, I gave up here during the competition, after which someone told me that the solution was PHP deserialisation, and a few Google searches later, I solved it (yay).*\n\nDeserialising the object, we get:\n\n\n`__PHP_Incomplete_Class Object`\n`(`\n`    [__PHP_Incomplete_Class_Name] => User`\n`    [name] => User86968804`\n`)`\n\nEssentially, the token is a serialized PHP object of class `User` and a value for name.\n\nVery interesting. We may be able to exploit this in the future as the code displays \"Welcome to the Libwary, {name}\"\n\n\nFiles and source\n-\n\nWe are given a file, Libwary.zip. In it we have 2 PHP files, index.php and util.php as well as a directory containing the books, fakeflag.txt and flag.txt, of course with the redacted flag.\n\nOpening util.php, we can see the following:\n\n\n\n![Alt text](https://www.pexels.com/photo/a-close-up-of-a-blue-glacier-20147180/)\n\nWe notice that there are two classes,  `book`  and `user`. The User class does... well not really anything. However, the book class is interesting. We can see that it uses the `$name` variable to find the corresponding book and then returns the content whenever an instance of the class is treated as a string.\n\nAlso note that if the name is not `fakeflag` but the name contains \"flag\", the word \"flag\" gets deleted.\n\n\nEXPLOIT\n=======\nNow for the fun part, exploitation.\n\nThe Big Idea\n--\nThe main vulnerability lies in these two lines:\n\n`$user = unserialize(base64_decode($_COOKIE['PHPSESSID']));`\nand, of course\n`echo $user;`\n\nIf we can get `echo $user` to echo the contents of a Book object, we could just use that to get the contents of flag.txt. \n\nVery conveniently, the `__tostring()` function does exactly what we need. If we just changed the PHPSESSID cookie to a serialised object of class `Book`, like, say, I don't know, a `Book` object with the name flag.txt, it would just echo out the contents.\n\nExecution\n--\n\nFirstly, we create a serialised object that looks like this:\n\n`O:4:\"Book\":1:{s:4:\"name\";s:8:\"flag.txt\";}`\n\nThis creates an instance of `Book` that has the name \"flag.txt\".\n\nNext, we encode it in Base64 to get this:\n\n`Tzo0OiJCb29rIjoxOntzOjQ6Im5hbWUiO3M6ODoiZmxhZy50eHQiO30`\n\nPassing this into our PHPSESSID and...\n\nimage to be added\n\nWhoops. Forgot about the final defence code.\n\n`//final defence`\n \n` if ($this->name != \"fakeflag.txt\") $this->name = str_ireplace(\"flag\", \"\", $this->name);`\n\nHowever, this is an easy fix. We just change up our serialised object to this:\n `O:4:\"Book\":1:{s:4:\"name\";s:12:\"flaflagg.txt\";}` \n\nWhen the code tries to replace the \"flag\" inf \"flaflagg\", it just gives us back \"flag.txt\"\n\nRe-encoding and re-serialising, we get:\n\n`Tzo0OiJCb29rIjoxOntzOjQ6Im5hbWUiO3M6MTI6ImZsZmxhZ2FnLnR4dCI7fQ`\n\nNow we pass this into our PHPSESSID and..\n\nimage\n\nBam. Flag.","slug":"liwary","published":1,"updated":"2024-02-29T14:17:23.739Z","comments":1,"layout":"post","photos":[],"_id":"clt7dls4v00002ondch1pgqhj","content":"<p>Libwary Writeup</p>\n<p><em>Disclaimer: I neither did this completely on my own nor did this during the competition. Although I solved 90% on my own, I did get a pretty big hint</em></p>\n<h1 id=\"RECON\"><a href=\"#RECON\" class=\"headerlink\" title=\"RECON\"></a>RECON</h1><h2 id=\"The-Website\"><a href=\"#The-Website\" class=\"headerlink\" title=\"The Website\"></a>The Website</h2><p>We are presented with a dropdown menu with 5 books. One of them is called “The flag”, which obviously immediately gives us the flag and this writeup doesn’t actually exist.</p>\n<p>Moving on, we can select which book to read, and it its contents are shown on the page.</p>\n<p>There aren’t any other ways to give user inputs, and we can’t modify any of the options, so we look elsewhere. I noticed that there is a PHPSESSID, of course in base64.<br>Decrypting this, we are provided with a serialised PHP object.</p>\n<p><code>O:4:&quot;User&quot;:1:&#123;s:4:&quot;name&quot;;s:12:&quot;User86968804&quot;;&#125;</code></p>\n<p><em>Here comes me being dumb. As this was my first ever CTF competition, I had very little experience and had no clue what PHP deserialisation was. So, I gave up here during the competition, after which someone told me that the solution was PHP deserialisation, and a few Google searches later, I solved it (yay).</em></p>\n<p>Deserialising the object, we get:</p>\n<p><code>__PHP_Incomplete_Class Object</code><br><code>(</code><br><code>    [__PHP_Incomplete_Class_Name] =&gt; User</code><br><code>    [name] =&gt; User86968804</code><br><code>)</code></p>\n<p>Essentially, the token is a serialized PHP object of class <code>User</code> and a value for name.</p>\n<p>Very interesting. We may be able to exploit this in the future as the code displays “Welcome to the Libwary, {name}”</p>\n<h2 id=\"Files-and-source\"><a href=\"#Files-and-source\" class=\"headerlink\" title=\"Files and source\"></a>Files and source</h2><p>We are given a file, Libwary.zip. In it we have 2 PHP files, index.php and util.php as well as a directory containing the books, fakeflag.txt and flag.txt, of course with the redacted flag.</p>\n<p>Opening util.php, we can see the following:</p>\n<p><img src=\"https://www.pexels.com/photo/a-close-up-of-a-blue-glacier-20147180/\" alt=\"Alt text\"></p>\n<p>We notice that there are two classes,  <code>book</code>  and <code>user</code>. The User class does… well not really anything. However, the book class is interesting. We can see that it uses the <code>$name</code> variable to find the corresponding book and then returns the content whenever an instance of the class is treated as a string.</p>\n<p>Also note that if the name is not <code>fakeflag</code> but the name contains “flag”, the word “flag” gets deleted.</p>\n<h1 id=\"EXPLOIT\"><a href=\"#EXPLOIT\" class=\"headerlink\" title=\"EXPLOIT\"></a>EXPLOIT</h1><p>Now for the fun part, exploitation.</p>\n<h2 id=\"The-Big-Idea\"><a href=\"#The-Big-Idea\" class=\"headerlink\" title=\"The Big Idea\"></a>The Big Idea</h2><p>The main vulnerability lies in these two lines:</p>\n<p><code>$user = unserialize(base64_decode($_COOKIE[&#39;PHPSESSID&#39;]));</code><br>and, of course<br><code>echo $user;</code></p>\n<p>If we can get <code>echo $user</code> to echo the contents of a Book object, we could just use that to get the contents of flag.txt. </p>\n<p>Very conveniently, the <code>__tostring()</code> function does exactly what we need. If we just changed the PHPSESSID cookie to a serialised object of class <code>Book</code>, like, say, I don’t know, a <code>Book</code> object with the name flag.txt, it would just echo out the contents.</p>\n<h2 id=\"Execution\"><a href=\"#Execution\" class=\"headerlink\" title=\"Execution\"></a>Execution</h2><p>Firstly, we create a serialised object that looks like this:</p>\n<p><code>O:4:&quot;Book&quot;:1:&#123;s:4:&quot;name&quot;;s:8:&quot;flag.txt&quot;;&#125;</code></p>\n<p>This creates an instance of <code>Book</code> that has the name “flag.txt”.</p>\n<p>Next, we encode it in Base64 to get this:</p>\n<p><code>Tzo0OiJCb29rIjoxOntzOjQ6Im5hbWUiO3M6ODoiZmxhZy50eHQiO30</code></p>\n<p>Passing this into our PHPSESSID and…</p>\n<p>image to be added</p>\n<p>Whoops. Forgot about the final defence code.</p>\n<p><code>//final defence</code></p>\n<p><code> if ($this-&gt;name != &quot;fakeflag.txt&quot;) $this-&gt;name = str_ireplace(&quot;flag&quot;, &quot;&quot;, $this-&gt;name);</code></p>\n<p>However, this is an easy fix. We just change up our serialised object to this:<br> <code>O:4:&quot;Book&quot;:1:&#123;s:4:&quot;name&quot;;s:12:&quot;flaflagg.txt&quot;;&#125;</code> </p>\n<p>When the code tries to replace the “flag” inf “flaflagg”, it just gives us back “flag.txt”</p>\n<p>Re-encoding and re-serialising, we get:</p>\n<p><code>Tzo0OiJCb29rIjoxOntzOjQ6Im5hbWUiO3M6MTI6ImZsZmxhZ2FnLnR4dCI7fQ</code></p>\n<p>Now we pass this into our PHPSESSID and..</p>\n<p>image</p>\n<p>Bam. Flag.</p>\n","excerpt":"","more":"<p>Libwary Writeup</p>\n<p><em>Disclaimer: I neither did this completely on my own nor did this during the competition. Although I solved 90% on my own, I did get a pretty big hint</em></p>\n<h1 id=\"RECON\"><a href=\"#RECON\" class=\"headerlink\" title=\"RECON\"></a>RECON</h1><h2 id=\"The-Website\"><a href=\"#The-Website\" class=\"headerlink\" title=\"The Website\"></a>The Website</h2><p>We are presented with a dropdown menu with 5 books. One of them is called “The flag”, which obviously immediately gives us the flag and this writeup doesn’t actually exist.</p>\n<p>Moving on, we can select which book to read, and it its contents are shown on the page.</p>\n<p>There aren’t any other ways to give user inputs, and we can’t modify any of the options, so we look elsewhere. I noticed that there is a PHPSESSID, of course in base64.<br>Decrypting this, we are provided with a serialised PHP object.</p>\n<p><code>O:4:&quot;User&quot;:1:&#123;s:4:&quot;name&quot;;s:12:&quot;User86968804&quot;;&#125;</code></p>\n<p><em>Here comes me being dumb. As this was my first ever CTF competition, I had very little experience and had no clue what PHP deserialisation was. So, I gave up here during the competition, after which someone told me that the solution was PHP deserialisation, and a few Google searches later, I solved it (yay).</em></p>\n<p>Deserialising the object, we get:</p>\n<p><code>__PHP_Incomplete_Class Object</code><br><code>(</code><br><code>    [__PHP_Incomplete_Class_Name] =&gt; User</code><br><code>    [name] =&gt; User86968804</code><br><code>)</code></p>\n<p>Essentially, the token is a serialized PHP object of class <code>User</code> and a value for name.</p>\n<p>Very interesting. We may be able to exploit this in the future as the code displays “Welcome to the Libwary, {name}”</p>\n<h2 id=\"Files-and-source\"><a href=\"#Files-and-source\" class=\"headerlink\" title=\"Files and source\"></a>Files and source</h2><p>We are given a file, Libwary.zip. In it we have 2 PHP files, index.php and util.php as well as a directory containing the books, fakeflag.txt and flag.txt, of course with the redacted flag.</p>\n<p>Opening util.php, we can see the following:</p>\n<p><img src=\"https://www.pexels.com/photo/a-close-up-of-a-blue-glacier-20147180/\" alt=\"Alt text\"></p>\n<p>We notice that there are two classes,  <code>book</code>  and <code>user</code>. The User class does… well not really anything. However, the book class is interesting. We can see that it uses the <code>$name</code> variable to find the corresponding book and then returns the content whenever an instance of the class is treated as a string.</p>\n<p>Also note that if the name is not <code>fakeflag</code> but the name contains “flag”, the word “flag” gets deleted.</p>\n<h1 id=\"EXPLOIT\"><a href=\"#EXPLOIT\" class=\"headerlink\" title=\"EXPLOIT\"></a>EXPLOIT</h1><p>Now for the fun part, exploitation.</p>\n<h2 id=\"The-Big-Idea\"><a href=\"#The-Big-Idea\" class=\"headerlink\" title=\"The Big Idea\"></a>The Big Idea</h2><p>The main vulnerability lies in these two lines:</p>\n<p><code>$user = unserialize(base64_decode($_COOKIE[&#39;PHPSESSID&#39;]));</code><br>and, of course<br><code>echo $user;</code></p>\n<p>If we can get <code>echo $user</code> to echo the contents of a Book object, we could just use that to get the contents of flag.txt. </p>\n<p>Very conveniently, the <code>__tostring()</code> function does exactly what we need. If we just changed the PHPSESSID cookie to a serialised object of class <code>Book</code>, like, say, I don’t know, a <code>Book</code> object with the name flag.txt, it would just echo out the contents.</p>\n<h2 id=\"Execution\"><a href=\"#Execution\" class=\"headerlink\" title=\"Execution\"></a>Execution</h2><p>Firstly, we create a serialised object that looks like this:</p>\n<p><code>O:4:&quot;Book&quot;:1:&#123;s:4:&quot;name&quot;;s:8:&quot;flag.txt&quot;;&#125;</code></p>\n<p>This creates an instance of <code>Book</code> that has the name “flag.txt”.</p>\n<p>Next, we encode it in Base64 to get this:</p>\n<p><code>Tzo0OiJCb29rIjoxOntzOjQ6Im5hbWUiO3M6ODoiZmxhZy50eHQiO30</code></p>\n<p>Passing this into our PHPSESSID and…</p>\n<p>image to be added</p>\n<p>Whoops. Forgot about the final defence code.</p>\n<p><code>//final defence</code></p>\n<p><code> if ($this-&gt;name != &quot;fakeflag.txt&quot;) $this-&gt;name = str_ireplace(&quot;flag&quot;, &quot;&quot;, $this-&gt;name);</code></p>\n<p>However, this is an easy fix. We just change up our serialised object to this:<br> <code>O:4:&quot;Book&quot;:1:&#123;s:4:&quot;name&quot;;s:12:&quot;flaflagg.txt&quot;;&#125;</code> </p>\n<p>When the code tries to replace the “flag” inf “flaflagg”, it just gives us back “flag.txt”</p>\n<p>Re-encoding and re-serialising, we get:</p>\n<p><code>Tzo0OiJCb29rIjoxOntzOjQ6Im5hbWUiO3M6MTI6ImZsZmxhZ2FnLnR4dCI7fQ</code></p>\n<p>Now we pass this into our PHPSESSID and..</p>\n<p>image</p>\n<p>Bam. Flag.</p>\n"}],"PostAsset":[],"PostCategory":[],"PostTag":[],"Tag":[]}}