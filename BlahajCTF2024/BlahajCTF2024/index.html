<!DOCTYPE html>
<html lang="en" color-mode="light">

  <head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="author" content="John Doe" />
  <!-- Open Graph Description 简短摘要-->
  
  <!-- 用于搜索引擎的文章摘要 -->
  
  
  
  <title>
    
      BlahajCTF2024 
      
      
      |
    
     personjs&#39; website
  </title>

  
    <link rel="apple-touch-icon" href="/pfp.jpg">
    <link rel="icon" href="/pfp.jpg">
  

  <!-- Raleway-Font -->
  <link href="https://fonts.googleapis.com/css?family=Raleway&display=swap" rel="stylesheet">

  <!-- hexo site css -->
  <link rel="stylesheet" href="/css/main.css" />
  <link rel="stylesheet" href="//at.alicdn.com/t/font_1886449_67xjft27j1l.css" />
  <!-- 代码块风格 -->
  

  <!-- jquery3.3.1 -->
  
    <script defer type="text/javascript" src="/plugins/jquery.min.js"></script>
  

  <!-- fancybox -->
  
    <link href="/plugins/jquery.fancybox.min.css" rel="stylesheet">
    <script defer type="text/javascript" src="/plugins/jquery.fancybox.min.js"></script>
  
  
<script src="/js/fancybox.js"></script>


  

  

  <script>
    var html = document.documentElement
    const colorMode = localStorage.getItem('color-mode')
    if (colorMode) {
      document.documentElement.setAttribute('color-mode', colorMode)
    }
  </script>
<meta name="generator" content="Hexo 7.1.1"></head>


  <body>
    <div id="app">
      <div class="header">
  <div class="avatar">
    <a href="/">
      <!-- 头像取消懒加载，添加no-lazy -->
      
        <img src="/pfp.jpg" alt="">
      
    </a>
    <div class="nickname"><a href="/">personjs</a></div>
  </div>
  <div class="navbar">
    <ul>
      
        <li class="nav-item" data-path="/">
          <a href="/">Home</a>
        </li>
      
        <li class="nav-item" data-path="/archives/">
          <a href="/archives/">Archives</a>
        </li>
      
        <li class="nav-item" data-path="/categories/">
          <a href="/categories/">Categories</a>
        </li>
      
        <li class="nav-item" data-path="/tags/">
          <a href="/tags/">Tags</a>
        </li>
      
        <li class="nav-item" data-path="/friends/">
          <a href="/friends/">Friends</a>
        </li>
      
        <li class="nav-item" data-path="/about/">
          <a href="/about/">About</a>
        </li>
      
    </ul>
  </div>
</div>


<script src="/js/activeNav.js"></script>



      <div class="flex-container">
        <!-- 文章详情页，展示文章具体内容，url形式：https://yoursite/文章标题/ -->
<!-- 同时为「标签tag」，「朋友friend」，「分类categories」，「关于about」页面的承载页面，具体展示取决于page.type -->


  <!-- LaTex Display -->

  
    <script async type="text/javascript" src="/plugins/mathjax/tex-chtml.js"></script>
  
  <script>
    MathJax = {
      tex: {
        inlineMath: [['$', '$'], ['\\(', '\\)']]
      }
    }
  </script>





  <!-- clipboard -->

  
    <script async type="text/javascript" src="/plugins/clipboard.min.js"></script>
  
  
<script src="/js/codeCopy.js"></script>







  

  

  

  
  <!-- 文章内容页 url形式：https://yoursite/文章标题/ -->
  <div class="container post-details" id="post-details">
    <div class="post-content">
      <div class="post-title">BlahajCTF2024</div>
      <div class="post-attach">
        <span class="post-pubtime">
          <i class="iconfont icon-updatetime mr-10" title="Update time"></i>
          2024-11-26 14:54:12
        </span>
        
              <span class="post-categories">
                <i class="iconfont icon-bookmark" title="Categories"></i>
                
                <span class="span--category">
                  <a href="/categories/BlahajCTF2024/" title="BlahajCTF2024">
                    <b>#</b> BlahajCTF2024
                  </a>
                </span>
                
              </span>
          
              <span class="post-tags">
                <i class="iconfont icon-tags mr-10" title="Tags"></i>
                
                <span class="span--tag mr-8">
                  <a href="/tags/ctf-web-pwn-rev-forens/" title="ctf, web, pwn, rev, forens">
                    #ctf, web, pwn, rev, forens
                  </a>
                </span>
                
              </span>
          
      </div>
      <div class="markdown-body">
        <h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>I participated in my first ever BlahajCTF this year, and although getting any prizes was way out of my skill level, I’m happy that I managed to get into the finals as one of the ~3 secondary school teams. In total, I earned our team around 5800 points, so here are some of my writeups for some of the challenges I solved during (and some after) the CTF.</p>
<h2 id="CRYPTO"><a href="#CRYPTO" class="headerlink" title="CRYPTO"></a>CRYPTO</h2><p>For crypto, we got a bunch of nice crypto problems from math to bit math to nice thinking problems. I’ll be going through <strong>Beginner RC4</strong> and <strong>otp</strong>.</p>
<h3 id="Beginner-RC4"><a href="#Beginner-RC4" class="headerlink" title="Beginner RC4"></a>Beginner RC4</h3><p>This was a beginner&#x2F;intermediate crypto challenge on a custom implementation of the RC4 cryptosystem.</p>
<h4 id="Files"><a href="#Files" class="headerlink" title="Files"></a>Files</h4><p><code>chall.py</code>:</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">RC4_KeySchedule</span>(<span class="params">key, S</span>):</span><br><span class="line">    j = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(key)):</span><br><span class="line">        j = (j + S[i] + key[i]) % <span class="number">16</span></span><br><span class="line">        S[i], S[j] = S[j], S[i]</span><br><span class="line">    <span class="keyword">return</span> S</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">encrypt</span>(<span class="params">message, key</span>):</span><br><span class="line">    state = RC4_KeySchedule(key, <span class="built_in">list</span>(<span class="built_in">range</span>(<span class="number">16</span>))) <span class="comment"># This was taken from RC4, surely its secure!</span></span><br><span class="line">    output = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(message)):</span><br><span class="line">        m = message[i]</span><br><span class="line">        s = state[i % <span class="built_in">len</span>(state)]</span><br><span class="line">        output.append(m ^ s)</span><br><span class="line">        <span class="keyword">if</span> i % <span class="built_in">len</span>(state) == <span class="number">0</span>:</span><br><span class="line">            state = RC4_KeySchedule(state, state) <span class="comment"># this must be secure, right? You can&#x27;t figure next xor stream data without knowing the state!</span></span><br><span class="line">    <span class="keyword">return</span> output</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> os <span class="keyword">import</span> urandom</span><br><span class="line"></span><br><span class="line">key = urandom(<span class="number">16</span>)           </span><br><span class="line">flag = <span class="string">b&quot;The flag is blahaj&#123;?????????????????????????????????????&#125;&quot;</span></span><br><span class="line">ct = encrypt(flag, key)</span><br><span class="line"><span class="built_in">print</span>(ct)</span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">[83, 103, 109, 44, 99, 106, 98, 96, 32, 104, 122, 43, 96, 97, 107, 102, 101, 105, 124, 110, 56, 106, 127, 80, 99, 56, 102, 53, 94, 121, 57, 119, 119, 82, 127, 125, 62, 113, 102, 88, 58, 105, 51, 118, 93, 117, 52, 95, 121, 48, 109, 54, 113, 105, 115, 35, 116]</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure>

<hr>
<h4 id="Analysis"><a href="#Analysis" class="headerlink" title="Analysis"></a>Analysis</h4><p>We can see that the implementation is pretty safe, up until  <code>state = RC4_KeySchedule(state, state)</code>.<br>This tells us that the key scheduling operation is deterministic, or it is possible to undo the key scheduling operation as each input maps to exactly one output.<br>However, that won’t be necessary, as we will see.</p>
<hr>
<h4 id="Attack-plan"><a href="#Attack-plan" class="headerlink" title="Attack plan"></a>Attack plan</h4><p>Taking another look at the code, we can see that in the end, it’s just an XOR block cipher encryption scheme, which means that it is vulnerable to a Known Plaintext Attack. </p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(message)): </span><br><span class="line">	m = message[i]</span><br><span class="line">	s = state[i % <span class="built_in">len</span>(state)]</span><br><span class="line">	output.append(m ^ s)</span><br></pre></td></tr></table></figure>

<p>Since XOR is its own inverse, we can recover the key simply by doing $c \oplus m&#x3D;k$.<br>We can see that the ciphertext starts with <code>The flag is blahaj&#123;</code>, which is more than the 16 bytes we need to recover the first state used for the encryption process.<br>Then, we can simply generate the next states by running <code>state = RC4_KeySchedule(state, state)</code> and decrypt the flag. In fact, as <code>RC4</code> is also its own inverse, we can simply re-run the ciphertext through the encryption code to recover the flag, once we have set the initial value of <code>state</code> correctly.</p>
<hr>
<h4 id="Well-not-quite"><a href="#Well-not-quite" class="headerlink" title="Well, not quite"></a>Well, not quite</h4><p>A small hiccup is that the way the code decides when to generate a new <code>state</code> is by doing</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> i % <span class="built_in">len</span>(state) == <span class="number">0</span>:</span><br><span class="line">	state = RC4_KeySchedule(state, state)</span><br></pre></td></tr></table></figure>
<p>This seems to make sense, but the thing is $0\equiv0\mod 16$ so it will also generate a new state right after encrypting the first character. This means that the key used to encrypt the first byte and the next 15 bytes after that will be different.<br>This is an easy fix though, as we can simply look here</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">state = RC4_KeySchedule(key, <span class="built_in">list</span>(<span class="built_in">range</span>(<span class="number">16</span>)))</span><br></pre></td></tr></table></figure>
<p>realise that each number from 0 to 15 appears exactly once in each state, so we can simply XOR the bytes from index 1 to 15, see which one is missing, and use that as the first byte in the key.</p>
<h4 id="Solve-script"><a href="#Solve-script" class="headerlink" title="Solve script:"></a>Solve script:</h4><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> ctfCryptoLib <span class="keyword">import</span> *  <span class="comment"># My own library I built for some QOL, if you want to run my script uhh just code the XOR and remove this line i guess</span></span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">RC4_KeySchedule</span>(<span class="params">key, S</span>):  </span><br><span class="line">	j = <span class="number">0</span>  </span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(key)):  </span><br><span class="line">		j = (j + S[i] + key[i]) % <span class="number">16</span>  </span><br><span class="line">		S[i], S[j] = S[j], S[i]  </span><br><span class="line">	<span class="keyword">return</span> S  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">message = [<span class="number">83</span>, <span class="number">103</span>, <span class="number">109</span>, <span class="number">44</span>, <span class="number">99</span>, <span class="number">106</span>, <span class="number">98</span>, <span class="number">96</span>, <span class="number">32</span>, <span class="number">104</span>, <span class="number">122</span>, <span class="number">43</span>, <span class="number">96</span>, <span class="number">97</span>, <span class="number">107</span>, <span class="number">102</span>, <span class="number">101</span>, <span class="number">105</span>, <span class="number">124</span>, <span class="number">110</span>, <span class="number">56</span>, <span class="number">106</span>, <span class="number">127</span>, <span class="number">80</span>, <span class="number">99</span>, <span class="number">56</span>, <span class="number">102</span>, <span class="number">53</span>, <span class="number">94</span>, <span class="number">121</span>, <span class="number">57</span>, <span class="number">119</span>, <span class="number">119</span>, <span class="number">82</span>, <span class="number">127</span>, <span class="number">125</span>, <span class="number">62</span>, <span class="number">113</span>, <span class="number">102</span>, <span class="number">88</span>, <span class="number">58</span>, <span class="number">105</span>, <span class="number">51</span>, <span class="number">118</span>, <span class="number">93</span>, <span class="number">117</span>, <span class="number">52</span>, <span class="number">95</span>, <span class="number">121</span>, <span class="number">48</span>, <span class="number">109</span>, <span class="number">54</span>, <span class="number">113</span>, <span class="number">105</span>, <span class="number">115</span>, <span class="number">35</span>, <span class="number">116</span>]  </span><br><span class="line">state = <span class="built_in">list</span>(c <span class="keyword">for</span> c <span class="keyword">in</span> Xor(<span class="string">b&#x27;he flag is blah&#x27;</span>, message[<span class="number">1</span>:<span class="number">16</span>]).xor())  <span class="comment"># Convert bytes to ints</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">16</span>):</span><br><span class="line">	<span class="keyword">if</span> i <span class="keyword">not</span> <span class="keyword">in</span> state:</span><br><span class="line">		state = [i] + state</span><br><span class="line">		<span class="keyword">break</span></span><br><span class="line"><span class="built_in">print</span>(state)  <span class="comment"># [4, 15, 8, 12, 5, 6, 3, 7, 0, 1, 9, 11, 2, 13, 10, 14]  </span></span><br><span class="line">output = []  </span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">16</span>, <span class="built_in">len</span>(message)):  </span><br><span class="line">    m = message[i]  </span><br><span class="line">    s = state[i % <span class="built_in">len</span>(state)]  </span><br><span class="line">    output.append(m ^ s)  </span><br><span class="line">    <span class="built_in">print</span>(m, s, state, i)  </span><br><span class="line">    <span class="keyword">if</span> i % <span class="built_in">len</span>(state) == <span class="number">0</span>:  </span><br><span class="line">        state = RC4_KeySchedule(state, state)  </span><br><span class="line">  </span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;The flag is blah&#x27;</span> + <span class="string">&#x27;&#x27;</span>.join(<span class="built_in">chr</span>(b) <span class="keyword">for</span> b <span class="keyword">in</span> output))</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="otp"><a href="#otp" class="headerlink" title="otp"></a>otp</h3><p>One time pad challenge time.</p>
<h4 id="Files-1"><a href="#Files-1" class="headerlink" title="Files"></a>Files</h4><p><code>chall.py</code></p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"> </span><br><span class="line">FLAG = <span class="string">&quot;blahaj&#123;[REDACTED]&#125;&quot;</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">encrypt</span>(<span class="params">message</span>):</span><br><span class="line">    pw = []</span><br><span class="line">    enc = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(message)):</span><br><span class="line">        sec = <span class="number">0</span></span><br><span class="line">        <span class="keyword">while</span> sec &lt; <span class="number">1</span> <span class="keyword">or</span> sec &gt; <span class="number">255</span>:</span><br><span class="line">            sec = <span class="built_in">ord</span>(os.urandom(<span class="number">1</span>).decode(<span class="string">&quot;charmap&quot;</span>))</span><br><span class="line">        pw.append(sec)</span><br><span class="line">        enc += <span class="built_in">chr</span>((<span class="built_in">ord</span>(message[x]) + sec) % <span class="number">256</span>)</span><br><span class="line">    <span class="keyword">return</span> enc.encode(<span class="string">&quot;charmap&quot;</span>), pw</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Ever heard of the One-time pad? Surely, you cannot crack this scheme!&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;For more info: https://en.wikipedia.org/wiki/One-time_pad&quot;</span>)</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        cmd = <span class="built_in">input</span>(<span class="string">&#x27;Command: &#x27;</span>)</span><br><span class="line">        <span class="keyword">if</span> cmd == <span class="string">&#x27;encrypt&#x27;</span>:</span><br><span class="line">            message = <span class="built_in">input</span>(<span class="string">&quot;Please enter message: &quot;</span>)</span><br><span class="line">            enc, pw = encrypt(message)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;Your codebook is:&quot;</span>, pw)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;Encrypted message is:&quot;</span>, base64.b64encode(enc).decode(<span class="string">&quot;charmap&quot;</span>))</span><br><span class="line">        <span class="keyword">elif</span> cmd == <span class="string">&#x27;getflag&#x27;</span>:</span><br><span class="line">            enc, _ = encrypt(FLAG)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;Encrypted flag is:&quot;</span>, base64.b64encode(enc).decode(<span class="string">&quot;charmap&quot;</span>))</span><br><span class="line">        <span class="keyword">elif</span> cmd == <span class="string">&#x27;exit&#x27;</span>:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;Unrecognized command!&quot;</span>)</span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">    <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>

<h4 id="Analysis-1"><a href="#Analysis-1" class="headerlink" title="Analysis"></a>Analysis</h4><p>We have a few options. We can encrypt a message, get an encrypted flag and exit. Pretty simple stuff<br>Let’s take a look at the <code>encrypt</code> function:</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">encrypt</span>(<span class="params">message</span>):</span><br><span class="line">    pw = []</span><br><span class="line">    enc = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(message)):</span><br><span class="line">        sec = <span class="number">0</span></span><br><span class="line">        <span class="keyword">while</span> sec &lt; <span class="number">1</span> <span class="keyword">or</span> sec &gt; <span class="number">255</span>:</span><br><span class="line">            sec = <span class="built_in">ord</span>(os.urandom(<span class="number">1</span>).decode(<span class="string">&quot;charmap&quot;</span>))</span><br><span class="line">        pw.append(sec)</span><br><span class="line">        enc += <span class="built_in">chr</span>((<span class="built_in">ord</span>(message[x]) + sec) % <span class="number">256</span>)</span><br><span class="line">    <span class="keyword">return</span> enc.encode(<span class="string">&quot;charmap&quot;</span>), pw</span><br></pre></td></tr></table></figure>
<p>Looks pretty secure? Maybe. You may be thinking, the key could be anything, how can the flag be recovered? Except you’d be wrong, the key can’t be everything. Specifically, it cannot be 0.<br>Here,</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span> sec &lt; <span class="number">1</span> <span class="keyword">or</span> sec &gt; <span class="number">255</span>:</span><br><span class="line">	sec = <span class="built_in">ord</span>(os.urandom(<span class="number">1</span>).decode(<span class="string">&quot;charmap&quot;</span>))</span><br></pre></td></tr></table></figure>
<p>it regenerates that byte of the key if the byte is $byte &lt;1$ or $255 &gt; byte$. However, this can only happen if the byte is 0, as the range of a byte is only 0 to 255. As such, no byte of the flag will be XORed with 0, and no byte in our ciphertext will be the same as the corresponding byte of the flag (XOR with 0 does nothing, cannot be 0 -&gt; cannot do nothing -&gt; will be different).</p>
<h4 id="Attack-plan-1"><a href="#Attack-plan-1" class="headerlink" title="Attack plan"></a>Attack plan</h4><p>With this in mind, we can essentially encrypt the flag a bunch, save each of the ciphertexts, and check which byte never appears at all for each of the indexes of the ciphertext, which <em>should</em> be our corresponding byte of the flag if we run it enough times. After a little testing (i tried like 3 numbers lol) I settled on 2048 encrypted flags.</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64  </span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *  </span><br><span class="line">r = remote(<span class="string">&quot;188.166.198.74&quot;</span>, <span class="number">30015</span>)  </span><br><span class="line">  </span><br><span class="line">chars: <span class="built_in">list</span>[<span class="built_in">set</span>] = [<span class="built_in">set</span>() <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">25</span>)]  </span><br><span class="line">flag = <span class="string">&#x27;&#x27;</span></span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">getFlag</span>():  </span><br><span class="line">    r.recvuntil(<span class="string">b&#x27;mand: &#x27;</span>)  </span><br><span class="line">    r.sendline(<span class="string">b&#x27;getflag&#x27;</span>)  </span><br><span class="line">    r.recvuntil(<span class="string">b&#x27;flag is: &#x27;</span>)  </span><br><span class="line">    <span class="keyword">return</span> r.recvline().strip()  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2048</span>):  </span><br><span class="line">    enc_flag = base64.b64decode(getFlag())  </span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(enc_flag)):  </span><br><span class="line">        chars[i].add(enc_flag[i])  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> chars:  </span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0x20</span>, <span class="number">0x7f</span> + <span class="number">1</span>):  </span><br><span class="line">        <span class="keyword">if</span> j <span class="keyword">not</span> <span class="keyword">in</span> i:  </span><br><span class="line">            flag += j</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">  </span><br><span class="line"><span class="built_in">print</span>(flag)</span><br></pre></td></tr></table></figure>
<h2 id="PWN"><a href="#PWN" class="headerlink" title="PWN"></a>PWN</h2><p><strong>basic intro to FSOP</strong></p>
<p>This year’s iteration of BlahajCTF included some pretty cool pwn challenges (although the difficulty was kind of a bool instead of a float) with a pretty nice basic FSOP challenge. </p>
<h2 id="WEB"><a href="#WEB" class="headerlink" title="WEB"></a>WEB</h2><h2 id="REV"><a href="#REV" class="headerlink" title="REV"></a>REV</h2><h2 id="FORENSICS"><a href="#FORENSICS" class="headerlink" title="FORENSICS"></a>FORENSICS</h2>
      </div>
      
        <div class="prev-or-next">
          <div class="post-foot-next">
            
              <a href="/uncategorized/1337ctfwriteups/" target="_self">
                <i class="iconfont icon-chevronleft"></i>
                <span>Prev</span>
              </a>
            
          </div>
          <div class="post-attach">
            <span class="post-pubtime">
              <i class="iconfont icon-updatetime mr-10" title="Update time"></i>
              2024-11-26 14:54:12
            </span>
            
                  <span class="post-categories">
                    <i class="iconfont icon-bookmark" title="Categories"></i>
                    
                    <span class="span--category">
                      <a href="/categories/BlahajCTF2024/" title="BlahajCTF2024">
                        <b>#</b> BlahajCTF2024
                      </a>
                    </span>
                    
                  </span>
              
                  <span class="post-tags">
                    <i class="iconfont icon-tags mr-10" title="Tags"></i>
                    
                    <span class="span--tag mr-8">
                      <a href="/tags/ctf-web-pwn-rev-forens/" title="ctf, web, pwn, rev, forens">
                        #ctf, web, pwn, rev, forens
                      </a>
                    </span>
                    
                  </span>
              
          </div>
          <div class="post-foot-prev">
            
          </div>
        </div>
      
    </div>
    
  <div id="btn-catalog" class="btn-catalog">
    <i class="iconfont icon-catalog"></i>
  </div>
  <div class="post-catalog hidden" id="catalog">
    <div class="title">Contents</div>
    <div class="catalog-content">
      
        <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Introduction"><span class="toc-text">Introduction</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#CRYPTO"><span class="toc-text">CRYPTO</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Beginner-RC4"><span class="toc-text">Beginner RC4</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Files"><span class="toc-text">Files</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Analysis"><span class="toc-text">Analysis</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Attack-plan"><span class="toc-text">Attack plan</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Well-not-quite"><span class="toc-text">Well, not quite</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Solve-script"><span class="toc-text">Solve script:</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#otp"><span class="toc-text">otp</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Files-1"><span class="toc-text">Files</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Analysis-1"><span class="toc-text">Analysis</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Attack-plan-1"><span class="toc-text">Attack plan</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#PWN"><span class="toc-text">PWN</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#WEB"><span class="toc-text">WEB</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#REV"><span class="toc-text">REV</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#FORENSICS"><span class="toc-text">FORENSICS</span></a></li></ol></li></ol>
      
    </div>
  </div>

  
<script src="/js/catalog.js"></script>




    
      <div class="comments-container">
        







      </div>
    
  </div>


        
<div class="footer">
  <div class="social">
    <ul>
      
        <li>
          
              <a title="github" target="_blank" rel="noopener" href="https://github.com/Personjs0421">
                <i class="iconfont icon-github"></i>
              </a>
              
        </li>
        
    </ul>
  </div>
  
    
    <div class="footer-more">
      
        <a target="_blank" rel="noopener" href="https://github.com/zchengsite/hexo-theme-oranges">Copyright © 2024 Oranges</a>
        
    </div>
  
    
    <div class="footer-more">
      
        <a target="_blank" rel="noopener" href="https://github.com/zchengsite/hexo-theme-oranges">Theme by Oranges | Powered by Hexo</a>
        
    </div>
  
  
</div>

      </div>

      <div class="tools-bar">
        <div class="back-to-top tools-bar-item hidden">
  <a href="javascript: void(0)">
    <i class="iconfont icon-chevronup"></i>
  </a>
</div>


<script src="/js/backtotop.js"></script>



        
  <div class="search-icon tools-bar-item" id="search-icon">
    <a href="javascript: void(0)">
      <i class="iconfont icon-search"></i>
    </a>
  </div>

  <div class="search-overlay hidden">
    <div class="search-content" tabindex="0">
      <div class="search-title">
        <span class="search-icon-input">
          <a href="javascript: void(0)">
            <i class="iconfont icon-search"></i>
          </a>
        </span>
        
          <input type="text" class="search-input" id="search-input" placeholder="Search...">
        
        <span class="search-close-icon" id="search-close-icon">
          <a href="javascript: void(0)">
            <i class="iconfont icon-close"></i>
          </a>
        </span>
      </div>
      <div class="search-result" id="search-result"></div>
    </div>
  </div>

  <script type="text/javascript">
    var inputArea = document.querySelector("#search-input")
    var searchOverlayArea = document.querySelector(".search-overlay")

    inputArea.onclick = function() {
      getSearchFile()
      this.onclick = null
    }

    inputArea.onkeydown = function() {
      if(event.keyCode == 13)
        return false
    }

    function openOrHideSearchContent() {
      let isHidden = searchOverlayArea.classList.contains('hidden')
      if (isHidden) {
        searchOverlayArea.classList.remove('hidden')
        document.body.classList.add('hidden')
        // inputArea.focus()
      } else {
        searchOverlayArea.classList.add('hidden')
        document.body.classList.remove('hidden')
      }
    }

    function blurSearchContent(e) {
      if (e.target === searchOverlayArea) {
        openOrHideSearchContent()
      }
    }

    document.querySelector("#search-icon").addEventListener("click", openOrHideSearchContent, false)
    document.querySelector("#search-close-icon").addEventListener("click", openOrHideSearchContent, false)
    searchOverlayArea.addEventListener("click", blurSearchContent, false)

    var searchFunc = function (path, search_id, content_id) {
      'use strict';
      var $input = document.getElementById(search_id);
      var $resultContent = document.getElementById(content_id);
      $resultContent.innerHTML = "<ul><span class='local-search-empty'>First search, index file loading, please wait...<span></ul>";
      $.ajax({
        // 0x01. load xml file
        url: path,
        dataType: "xml",
        success: function (xmlResponse) {
          // 0x02. parse xml file
          var datas = $("entry", xmlResponse).map(function () {
            return {
              title: $("title", this).text(),
              content: $("content", this).text(),
              url: $("url", this).text()
            };
          }).get();
          $resultContent.innerHTML = "";

          $input.addEventListener('input', function () {
            // 0x03. parse query to keywords list
            var str = '<ul class=\"search-result-list\">';
            var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
            $resultContent.innerHTML = "";
            if (this.value.trim().length <= 0) {
              return;
            }
            // 0x04. perform local searching
            datas.forEach(function (data) {
              var isMatch = true;
              var content_index = [];
              if (!data.title || data.title.trim() === '') {
                data.title = "Untitled";
              }
              var orig_data_title = data.title.trim();
              var data_title = orig_data_title.toLowerCase();
              var orig_data_content = data.content.trim().replace(/<[^>]+>/g, "");
              var data_content = orig_data_content.toLowerCase();
              var data_url = data.url;
              var index_title = -1;
              var index_content = -1;
              var first_occur = -1;
              // only match artiles with not empty contents
              if (data_content !== '') {
                keywords.forEach(function (keyword, i) {
                  index_title = data_title.indexOf(keyword);
                  index_content = data_content.indexOf(keyword);

                  if (index_title < 0 && index_content < 0) {
                    isMatch = false;
                  } else {
                    if (index_content < 0) {
                      index_content = 0;
                    }
                    if (i == 0) {
                      first_occur = index_content;
                    }
                    // content_index.push({index_content:index_content, keyword_len:keyword_len});
                  }
                });
              } else {
                isMatch = false;
              }
              // 0x05. show search results
              if (isMatch) {
                str += "<li><a href='" + data_url + "' class='search-result-title'>" + orig_data_title + "</a>";
                var content = orig_data_content;
                if (first_occur >= 0) {
                  // cut out 100 characters
                  var start = first_occur - 20;
                  var end = first_occur + 80;

                  if (start < 0) {
                    start = 0;
                  }

                  if (start == 0) {
                    end = 100;
                  }

                  if (end > content.length) {
                    end = content.length;
                  }

                  var match_content = content.substr(start, end);

                  // highlight all keywords
                  keywords.forEach(function (keyword) {
                    var regS = new RegExp(keyword, "gi");
                    match_content = match_content.replace(regS, "<span class=\"search-keyword\">" + keyword + "</span>");
                  });

                  str += "<p class=\"search-result-abstract\">" + match_content + "...</p>"
                }
                str += "</li>";
              }
            });
            str += "</ul>";
            if (str.indexOf('<li>') === -1) {
              return $resultContent.innerHTML = "<ul><span class='local-search-empty'>No result<span></ul>";
            }
            $resultContent.innerHTML = str;
          });
        },
        error: function(xhr, status, error) {
          $resultContent.innerHTML = ""
          if (xhr.status === 404) {
            $resultContent.innerHTML = "<ul><span class='local-search-empty'>The search.xml file was not found, please refer to：<a href='https://github.com/zchengsite/hexo-theme-oranges#configuration' target='_black'>configuration</a><span></ul>";
          } else {
            $resultContent.innerHTML = "<ul><span class='local-search-empty'>The request failed, Try to refresh the page or try again later.<span></ul>";
          }
        }
      });
      $(document).on('click', '#search-close-icon', function() {
        $('#search-input').val('');
        $('#search-result').html('');
      });
    }

    var getSearchFile = function() {
        var path = "/search.xml";
        searchFunc(path, 'search-input', 'search-result');
    }
  </script>




        
  <div class="tools-bar-item theme-icon" id="switch-color-scheme">
    <a href="javascript: void(0)">
      <i id="theme-icon" class="iconfont icon-moon"></i>
    </a>
  </div>

  
<script src="/js/colorscheme.js"></script>





        
  
    <div class="share-icon tools-bar-item">
      <a href="javascript: void(0)" id="share-icon">
        <i class="iconfont iconshare"></i>
      </a>
      <div class="share-content hidden">
        
          <a class="share-item" href="https://twitter.com/intent/tweet?text=' + BlahajCTF2024 + '&url=' + https%3A%2F%2Fpersonjs0421.github.io%2FBlahajCTF2024%2FBlahajCTF2024%2F + '" target="_blank" title="Twitter">
            <i class="iconfont icon-twitter"></i>
          </a>
        
        
          <a class="share-item" href="https://www.facebook.com/sharer.php?u=https://personjs0421.github.io/BlahajCTF2024/BlahajCTF2024/" target="_blank" title="Facebook">
            <i class="iconfont icon-facebooksquare"></i>
          </a>
        
      </div>
    </div>
  
  
<script src="/js/shares.js"></script>



      </div>
    </div>
  </body>
</html>
